<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ABELENKPE SDA CHURCH</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
<style>
  /* Body and Background */
  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    background-image: url('https://images.unsplash.com/photo-1601924638867-3aa4c68d44b4?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMTI4NTl8MHwxfHNlYXJjaHwxfHxjaHVyY2glMjBhY3VyaWNhfGVufDB8fHx8MTY5MjUyMTc1NQ&ixlib=rb-4.0.3&q=80&w=1080');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    color: #fff;
  }

  header {
    background-color: rgba(247, 23, 23, 0.9);
    color: white;
    padding: 1rem;
    position: fixed;
    width: 100%;
    top: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    transition: all 0.3s ease;
  }

  header.shrink {
    padding: 0.5rem 1rem;
  }

  header img {
    height: 50px;
    margin-right: 0.5rem;
    transition: all 0.3s ease;
  }

  header.shrink img {
    height: 35px;
  }

  header h3 {
    margin: 0;
    font-size: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
  }

  header.shrink h3 {
    font-size: 1.2rem;
  }

  main {
    flex: 1 0 auto;
    padding-top: 140px;
    max-width: 900px;
    margin: auto;
    backdrop-filter: blur(6px);
  }

  footer {
    flex-shrink: 0;
    background-color: rgba(52, 58, 64, 0.9);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .fade-out { opacity: 0; transition: opacity 2s; }

  .card { margin-bottom: 1.5rem; background-color: rgba(0,0,0,0.6); color: #fff; }

  @media(max-width: 576px) {
    main { padding: 120px 1rem 1rem; }
    .d-flex { flex-direction: column; }
    .d-flex input, .d-flex button { width: 100%; margin-bottom: 0.5rem; }
  }
</style>
</head>
<body>

<header>
  <img src="images/sda logo.png" alt="Church Logo">
  <h3>ABELENKPE SDA CHURCH</h3>
</header>

<main class="container">
  <h2 class="mb-3 text-center">Welcome to Abelenkpe SDA Church</h2>
  <p class="text-center">Search for members or mark attendance.</p>

  <!-- Search & Mark Attendance Card -->
  <div class="card mb-3 shadow-sm">
    <div class="card-body text-center">
      <h5>Search & Mark Attendance</h5>
      <p>Enter your registered phone number or name to mark attendance.</p>
      <div class="d-flex mb-2">
        <input type="text" id="memberSearchInput" class="form-control me-2" placeholder="Enter name or phone">
        <button id="memberSearchBtn" class="btn btn-info">Search</button>
      </div>
      <div id="memberInfoBox" class="mt-2"></div>
    </div>
  </div>

  <!-- Quick Access -->
  <div class="card text-center shadow-sm">
    <div class="card-body">
      <h5>Quick Access</h5>
      <a href="registration.html" class="btn btn-success m-1">Register</a>
      <a href="login.html" class="btn btn-success m-1">Login</a>
    </div>
  </div>
</main>

<footer>
  &copy; <span id="year"></span> ABELENKPE SDA CHURCH. All Rights Reserved. | Contact: abelenkpesdachurch@gmail.com
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let members = JSON.parse(localStorage.getItem("members")) || [
    { fullName:'John Doe', role:'Class 1', phone:'0541111111', gender:'Male' },
    { fullName:'Mary Ann', role:'Class 5', phone:'0542222222', gender:'Female' },
    { fullName:'Peter Smith', role:'Other', phone:'0543333333', gender:'Male' }
  ];

  let currentSession = JSON.parse(localStorage.getItem("currentSession")) || { 
    active: true, 
    date: new Date().toISOString().slice(0,10), 
    time: new Date().toTimeString().slice(0,5), 
    presentPhones: [] 
  };

  const memberSearchInput = document.getElementById('memberSearchInput');
  const memberSearchBtn = document.getElementById('memberSearchBtn');
  const memberInfoBox = document.getElementById('memberInfoBox');

  function saveSession(){ localStorage.setItem("currentSession", JSON.stringify(currentSession)); }

  memberSearchBtn.addEventListener('click', () => {
    const query = memberSearchInput.value.trim().toLowerCase();
    if(!query) return;

    const member = members.find(m => 
      m.fullName.toLowerCase().includes(query) || m.phone.includes(query)
    );

    if(!member){
      memberInfoBox.innerHTML = `<span class="text-danger">⚠️ Member not found.</span>`;
    } else {
      const isPresent = currentSession.presentPhones.includes(member.phone);
      memberInfoBox.innerHTML = `
        <div class="card text-start p-2">
          <p><strong>Name:</strong> ${member.fullName}</p>
          <p><strong>Phone:</strong> ${member.phone}</p>
          <p><strong>Role:</strong> ${member.role}</p>
          <p><strong>Gender:</strong> ${member.gender}</p>
          <p><strong>Status:</strong> <span class="${isPresent ? 'text-success' : 'text-secondary'}">${isPresent ? 'Present' : 'Absent'}</span></p>
          <button class="btn btn-success w-100 mt-2 mark-attendance-btn">${isPresent ? 'Already Present' : 'Mark Attendance'}</button>
        </div>
      `;

      const markBtn = memberInfoBox.querySelector('.mark-attendance-btn');
      if(markBtn){
        markBtn.addEventListener('click', () => {
          if(!currentSession.active){
            alert('Attendance session is not active.');
            return;
          }
          if(!currentSession.presentPhones.includes(member.phone)){
            currentSession.presentPhones.push(member.phone);
            saveSession();
            memberInfoBox.querySelector('p:nth-child(5) span').className = 'text-success';
            memberInfoBox.querySelector('p:nth-child(5) span').textContent = 'Present';
            markBtn.textContent = 'Already Present';
          }
        });
      }
    }

    setTimeout(() => { memberInfoBox.innerHTML = ''; }, 30000);
  });

  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
