<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Attendance â€“ ABELENKPE SDA CHURCH</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
<style>
body { display:flex; flex-direction:column; min-height:100vh; margin:0; background:#f8f9fa; font-family:Arial,sans-serif; }
header { background:#d63384; color:white; padding:1rem; position:fixed; top:0; width:100%; z-index:1000; display:flex; justify-content:space-between; flex-wrap:wrap; align-items:center; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
header h3 { margin:0; font-size:1.6rem; }
nav a { margin:0 0.3rem; }
main { flex:1 0 auto; padding:120px 15px 20px; max-width:1200px; margin:auto; }
.card { margin-bottom:20px; }
footer { flex-shrink:0; background:#343a40; color:white; padding:1rem; text-align:center; font-size:0.9rem; }
.stat-card { border-radius:14px; color:#fff; box-shadow:0 8px 20px rgba(0,0,0,.15); text-align:center; padding:1rem; }
.stat-all { background:linear-gradient(135deg,#ff416c,#ff4b2b); }
.stat-present { background:linear-gradient(135deg,#00c6ff,#0072ff); }
.stat-absent { background:linear-gradient(135deg,#8e2de2,#4a00e0); }
.badge-role { font-size:.75rem; }
.present-pill { font-size:.8rem; }
.calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
.calendar .day { background:#fff; border-radius:8px; border:1px solid #e5e7eb; padding:8px; text-align:center; cursor:pointer; }
.calendar .day.has-record { background:linear-gradient(135deg,#d63384,#ff69b4); color:#fff; font-weight:600; }
.calendar .day.selected { outline:2px solid #212529; }
</style>
</head>
<body>

<header class="d-flex align-items-center justify-content-between flex-wrap gap-2">
  <h3>Attendance System</h3>
  <nav class="d-flex gap-2 flex-wrap">
    <a href="#" class="btn btn-light btn-sm">Home</a>
    <a href="#" class="btn btn-light btn-sm">Register</a>
    <a href="#" class="btn btn-light btn-sm">Admin</a>
    <a href="#" class="btn btn-light btn-sm">Sessions</a>
  </nav>
</header>

<main>
<h2 class="text-center mb-4">ðŸ“… Attendance Dashboard</h2>

<!-- Stats -->
<div class="row g-3 mb-3">
  <div class="col-md-4">
    <div class="stat-card stat-all">
      <i class="bi bi-people-fill fs-1"></i>
      <div>Total Members</div>
      <div id="statTotal" class="display-6">0</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card stat-present">
      <i class="bi bi-person-check-fill fs-1"></i>
      <div>Present</div>
      <div id="statPresent" class="display-6">0</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card stat-absent">
      <i class="bi bi-person-x-fill fs-1"></i>
      <div>Absent</div>
      <div id="statAbsent" class="display-6">0</div>
    </div>
  </div>
</div>

<!-- Active Session Control -->
<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
      <h5>Session Control</h5>
      <span id="pillSession" class="badge bg-secondary">No Active Session</span>
    </div>
    <div class="row g-2">
      <div class="col-md-4">
        <label>Date</label>
        <input id="inDate" type="date" class="form-control"/>
      </div>
      <div class="col-md-4">
        <label>Time</label>
        <input id="inTime" type="time" class="form-control"/>
      </div>
      <div class="col-md-4 d-grid gap-2">
        <button id="btnStart" class="btn btn-primary">Start Session</button>
        <button id="btnClose" class="btn btn-danger">Close Session</button>
      </div>
    </div>
  </div>
</div>

<!-- Member List -->
<div class="card mb-3">
  <div class="card-body">
    <h5>Members</h5>
    <div class="input-group mb-2">
      <input id="inPhone" type="text" class="form-control" placeholder="Enter phone to mark present"/>
      <button id="btnMark" class="btn btn-success">Mark Present</button>
    </div>
    <ul id="listMembers" class="list-group"></ul>
  </div>
</div>

<!-- Calendar & History -->
<div class="card">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6">
        <h5>Calendar</h5>
        <div id="calendar" class="calendar"></div>
        <div class="d-flex justify-content-between mt-2">
          <button id="prevMonth" class="btn btn-sm btn-light">â—€ Prev</button>
          <span id="labelMonth" class="fw-semibold"></span>
          <button id="nextMonth" class="btn btn-sm btn-light">Next â–¶</button>
        </div>
      </div>
      <div class="col-md-6">
        <h5>Attendance History</h5>
        <div class="d-flex gap-2 mb-2">
          <input type="radio" class="btn-check" name="viewMode" id="viewPresent" autocomplete="off" checked>
          <label class="btn btn-outline-success btn-sm" for="viewPresent">Present</label>
          <input type="radio" class="btn-check" name="viewMode" id="viewAbsent" autocomplete="off">
          <label class="btn btn-outline-danger btn-sm" for="viewAbsent">Absent</label>
        </div>
        <div>Selected Date: <span id="selDate">â€”</span></div>
        <ul id="listHistory" class="list-group mt-2" style="max-height:300px; overflow:auto;"></ul>
        <button id="btnNotifySelDate" class="btn btn-warning mt-2" disabled>Notify Selected Absentees</button>
      </div>
    </div>
  </div>
</div>

</main>
<footer>&copy; <span id="year"></span> ABELENKPE SDA CHURCH</footer>

<script>
/* ===== State & Storage ===== */
const LS_KEYS = { members:'members', session:'currentSession', history:'attendanceHistory'};
let members = JSON.parse(localStorage.getItem(LS_KEYS.members)) || [
  {fullName:'John Doe',phone:'233501234567',role:'Class 1'},
  {fullName:'Mary Smith',phone:'233501234568',role:'Class 2'},
  {fullName:'Peter Pan',phone:'233501234569',role:'Class 3'}
];
let currentSession = JSON.parse(localStorage.getItem(LS_KEYS.session)) || {active:false,date:null,time:null,presentPhones:[]};
let attendanceHistory = JSON.parse(localStorage.getItem(LS_KEYS.history)) || [];

/* ===== Elements ===== */
const statTotal = document.getElementById('statTotal');
const statPresent = document.getElementById('statPresent');
const statAbsent = document.getElementById('statAbsent');
const pillSession = document.getElementById('pillSession');
const inDate = document.getElementById('inDate');
const inTime = document.getElementById('inTime');
const inPhone = document.getElementById('inPhone');
const btnStart = document.getElementById('btnStart');
const btnClose = document.getElementById('btnClose');
const btnMark = document.getElementById('btnMark');
const listMembers = document.getElementById('listMembers');
const calendar = document.getElementById('calendar');
const labelMonth = document.getElementById('labelMonth');
const prevMonth = document.getElementById('prevMonth');
const nextMonth = document.getElementById('nextMonth');
const selDate = document.getElementById('selDate');
const listHistory = document.getElementById('listHistory');
const viewPresent = document.getElementById('viewPresent');
const viewAbsent = document.getElementById('viewAbsent');
const btnNotifySelDate = document.getElementById('btnNotifySelDate');

/* ===== Utility ===== */
const saveMembers = ()=>localStorage.setItem(LS_KEYS.members,JSON.stringify(members));
const saveSession = ()=>localStorage.setItem(LS_KEYS.session,JSON.stringify(currentSession));
const saveHistory = ()=>localStorage.setItem(LS_KEYS.history,JSON.stringify(attendanceHistory));

function updateStats(){
  statTotal.textContent = members.length;
  statPresent.textContent = currentSession.active ? currentSession.presentPhones.length : 0;
  statAbsent.textContent = currentSession.active ? members.length-currentSession.presentPhones.length : 0;
  pillSession.innerHTML = currentSession.active ? `<span class='badge bg-warning text-dark'>Active: ${currentSession.date} ${currentSession.time}</span>` : `<span class='badge bg-secondary'>No Active Session</span>`;
}

function renderMembers(){
  listMembers.innerHTML='';
  members.forEach(m=>{
    const li=document.createElement('li');
    li.className='list-group-item d-flex justify-content-between align-items-center';
    const present = currentSession.presentPhones.includes(m.phone);
    li.innerHTML=`<span>${m.fullName} (${m.role}) - ${m.phone} <span class="badge ${present?'bg-success':'bg-secondary'}">${present?'Present':'Absent'}</span></span>
    <button class="btn btn-sm ${present?'btn-outline-success':'btn-success'} btn-toggle" data-phone="${m.phone}">${present?'Mark Absent':'Mark Present'}</button>`;
    listMembers.appendChild(li);
  });
  listMembers.querySelectorAll('.btn-toggle').forEach(btn=>btn.addEventListener('click',()=>{
    if(!currentSession.active){alert('Start a session first'); return;}
    const phone=btn.dataset.phone;
    const idx=currentSession.presentPhones.indexOf(phone);
    if(idx===-1) currentSession.presentPhones.push(phone); else currentSession.presentPhones.splice(idx,1);
    saveSession(); updateStats(); renderMembers();
  }));
}

/* ===== Session Controls ===== */
btnStart.addEventListener('click',()=>{
  currentSession={active:true,date:inDate.value||new Date().toISOString().slice(0,10),time:inTime.value||new Date().toTimeString().slice(0,5),presentPhones:[]};
  saveSession(); updateStats(); renderMembers(); alert('Session started');
});

btnClose.addEventListener('click',()=>{
  if(!currentSession.active){alert('No active session'); return;}
  const allPhones=members.map(m=>m.phone);
  const absentPhones=allPhones.filter(p=>!currentSession.presentPhones.includes(p));
  attendanceHistory.push({...currentSession,absentPhones,closedAt:new Date().toISOString(),active:false});
  saveHistory();
  currentSession={active:false,date:null,time:null,presentPhones:[]};
  saveSession(); updateStats(); renderMembers(); buildCalendar(); alert('Session closed and saved');
});

/* ===== Quick Mark by Phone ===== */
btnMark.addEventListener('click',()=>{
  if(!currentSession.active){alert('Start session first'); return;}
  const p=inPhone.value.trim();
  if(!p){alert('Enter phone'); return;}
  if(!currentSession.presentPhones.includes(p)) currentSession.presentPhones.push(p);
  saveSession(); updateStats(); renderMembers();
});

/* ===== Calendar ===== */
let calMonth=(new Date()).getMonth(),calYear=(new Date()).getFullYear();
function buildCalendar(){
  calendar.innerHTML=''; const firstDay=new Date(calYear,calMonth,1).getDay();
  const days=new Date(calYear,calMonth+1,0).getDate();
  labelMonth.textContent=`${calYear}-${String(calMonth+1).padStart(2,'0')}`;
  for(let i=0;i<firstDay;i++) calendar.appendChild(document.createElement('div'));
  for(let d=1;d<=days;d++){
    const dateStr=`${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dayDiv=document.createElement('div'); dayDiv.className='day'; dayDiv.textContent=d;
    if(attendanceHistory.find(h=>h.date===dateStr)) dayDiv.classList.add('has-record');
    dayDiv.addEventListener('click',()=>{selDate.textContent=dateStr; renderHistoryList(dateStr); document.querySelectorAll('.calendar .day').forEach(dd=>dd.classList.remove('selected')); dayDiv.classList.add('selected');});
    calendar.appendChild(dayDiv);
  }
}
prevMonth.addEventListener('click',()=>{ calMonth--; if(calMonth<0){calMonth=11;calYear--;} buildCalendar(); });
nextMonth.addEventListener('click',()=>{ calMonth++; if(calMonth>11){calMonth=0;calYear++;} buildCalendar(); });

/* ===== History List ===== */
function renderHistoryList(dateStr){
  listHistory.innerHTML=''; const s=attendanceHistory.find(x=>x.date===dateStr);
  if(!s){ listHistory.innerHTML=`<li class='list-group-item'>No records.</li>`; btnNotifySelDate.disabled=true; return;}
  const showAbsent=viewAbsent.checked;
  const list=showAbsent ? members.filter(m=>!s.presentPhones.includes(m.phone)) : members.filter(m=>s.presentPhones.includes(m.phone));
  if(!list.length){ listHistory.innerHTML=`<li class='list-group-item'>No ${showAbsent?'absentees':'present'} on this date.</li>`; btnNotifySelDate.disabled=true; return;}
  list.forEach(m=>{
    const li=document.createElement('li'); li.className='list-group-item d-flex justify-content-between align-items-center';
    if(showAbsent && !s.active){ li.innerHTML=`<input type="checkbox" class="history-checkbox me-2" data-phone="${m.phone}"> ${m.fullName} (${m.role})`; } 
    else li.textContent=`${m.fullName} (${m.role})`; listHistory.appendChild(li);
  });
  btnNotifySelDate.disabled = !(showAbsent && !s.active && list.length>0);
}
viewPresent.addEventListener('change',()=>{ if(viewPresent.checked) renderHistoryList(selDate.textContent); });
viewAbsent.addEventListener('change',()=>{ if(viewAbsent.checked) renderHistoryList(selDate.textContent); });

/* ===== Notify Selected ===== */
btnNotifySelDate.addEventListener('click',()=>{
  const checkedBoxes=document.querySelectorAll('.history-checkbox:checked');
  if(!checkedBoxes.length){alert('No members selected'); return;}
  const selectedMembers=Array.from(checkedBoxes).map(cb=>members.find(m=>m.phone===cb.dataset.phone));
  selectedMembers.forEach((m,i)=>{
    setTimeout(()=>{
      const msg=`Hello ${m.fullName}, we missed you at church on ${selDate.textContent}!`;
      const waUrl=`https://wa.me/${m.phone.replace(/[^0-9]/g,'')}?text=${encodeURIComponent(msg)}`;
      window.open(waUrl,'_blank');
    }, i*500);
  });
  alert(`Sent messages to ${selectedMembers.length} member(s)`);
});

/* ===== Init ===== */
document.getElementById('year').textContent=new Date().getFullYear();
updateStats(); renderMembers(); buildCalendar();
</script>
</body>
</html>
